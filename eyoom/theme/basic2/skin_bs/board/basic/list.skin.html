<?php if (!defined('_GNUBOARD_')) exit; ?>

<div class="board-area">
<!--{? !_wr_id }-->
<section class="board-write">
	<form name="fwrite" id="fwrite" action="./write_update.php" onsubmit="return fwrite_submit(this);" method="post" enctype="multipart/form-data" autocomplete="off" class="eyoom-form">
	<input type="hidden" name="uid" value="<?php echo get_uniqid(); ?>">
	<input type="hidden" name="w" value="{_w}">
	<input type="hidden" name="bo_table" value="{_bo_table}">
	<input type="hidden" name="wr_id" value="{_wr_id}">
	<input type="hidden" name="sca" value="{_sca}">
	<input type="hidden" name="sfl" value="{_sfl}">
	<input type="hidden" name="stx" value="{_stx}">
	<input type="hidden" name="spt" value="{_spt}">
	<input type="hidden" name="sod" value="{_sod}">
	<input type="hidden" name="board_skin_path" value="{C.EYOOM_CORE_PATH}/board">
	<input type="hidden" name="wr_1" id="wr_1" value="{_wr_1}">
	<input type="hidden" name="wr_2" id="wr_2" value="{_wr_2}">
	<input type="hidden" name="wr_3" id="wr_3" value="{_wr_3}">
  <input type="hidden" name="wr_4" id="wr_4" value="{_wr_4}">
	<input type="hidden" name="wr_5" id="wr_5" value="{_wr_5}">
	<input type="hidden" name="wmode" id="wmode" value="{_wmode}">
	<div class="tbl_frm01 tbl_wrap">
		<div class="lbrow">
			<div class="lbtop">
				<div class="lbsubject">
					<div class="lbanonymous">
						<!--{? _is_anonymous}-->
						<label for="anonymous" class="checkbox"><input type="checkbox" id="anonymous" name="anonymous" value="y" checked><i></i>익명글</label>
						<!--{/}-->
					</div>
					<label for="wr_subject" class="sound_only">제목<strong class="sound_only"> 필수</strong></label>
					<label class="input">
	            <i class="icon-prepend fa fa-edit"></i>
	            <input type="text" name="wr_subject" value="{_subject}" id="wr_subject" required class="form-control" size="50" maxlength="255" placeholder="제목을 입력해 주세요.">
	            <b class="tooltip tooltip-top-left">제목을 입력해 주세요.</b>
	        </label>
				</div>
			</div>
			<div class="lbbottom">
				<div class="wr_content">
					<!--{* 에디터 사용시는 에디터로, 아니면 textarea 로 노출 *}-->
					<textarea id="wr_content" name="wr_content" style="height:36px;" maxlength="65536">내용을 입력해 주세요.</textarea>
				</div>
				<div class="lbsubmit">
					<button type="submit" id="btn_submit" accesskey="s" class="btn-e btn-e-lg btn-e-yellow margin-top-m-2"><i class="fa fa-paper-plane" aria-hidden="true"></i> 입력</button>
				</div>
			</div>
    </div>
		<div class="margin-hr-10"></div>
	</div>
	</form>
</section>

<script>
$save_val = $("#wr_content").val();
$("#wr_content").click(function(){
  if(!$(this).hasClass('txt_active')) {
    $(this).addClass('txt_active');
  }
  if($(this).val() == $save_val) {
    $(this).val('');
  }
}).focusin(function(){
  if(!$(this).hasClass('txt_active')) {
    $(this).addClass('txt_active');
  }
  if($(this).val() == $save_val) {
    $(this).val('');
  }
}).focusout(function(){
  if($(this).val() == '') {
    $(this).removeClass('txt_active');
    $(this).val($save_val);
  }
});
function fwrite_submit(f)
{
	<!--{? _is_anonymous}-->
  var wr_1 = '{_wr_1}';
	if($("#anonymous").is(':checked')) {
		wr_1 = wr_1+'|y';
		$("#wr_1").val(wr_1);
	}
	<!--{/}-->

	var subject = "";
	var content = "";
	$.ajax({
		url: g5_bbs_url+"/ajax.filter.php",
		type: "POST",
		data: {
			"subject": f.wr_subject.value,
			"content": f.wr_content.value
		},
		dataType: "json",
		async: false,
		cache: false,
		success: function(data, textStatus) {
			subject = data.subject;
			content = data.content;
		}
	});

	if (subject) {
		alert("제목에 금지단어('"+subject+"')가 포함되어있습니다");
		f.wr_subject.focus();
		return false;
	}

	if (content) {
		alert("내용에 금지단어('"+content+"')가 포함되어있습니다");
		if (typeof(ed_wr_content) != "undefined")
			ed_wr_content.returnFalse();
		else
			f.wr_content.focus();
		return false;
	}
	document.getElementById("btn_submit").disabled = "disabled";

	return true;
}
</script>
<style>
.board-write .board-write-title {border-bottom:1px solid #e5e5e5;padding-bottom:10px}
.wr_content {padding-right:70px;}
#wr_content {
	box-sizing:border-box;
	width:100% !important;
	-webkit-transition:height ease-in-out .2s;-moz-transition:height ease-in-out .2s;-o-transition:height ease-in-out .2s;transition:height ease-in-out .2s;font-size:12px;line-height:1.35;}
#wr_content.txt_active{height:120px !important;}
</style>
<!--{/}-->
<div class="board-list">
    <!--{* 게시판 페이지 정보 및 버튼 시작 *}-->
    <div class="board-info margin-bottom-10">
        <div class="clearfix"></div>
    </div>
    <!--{* 게시판 페이지 정보 및 버튼 끝 *}-->

	<!--{? _is_admin}-->
    <form name="fboardlist" id="fboardlist" action="./board_list_update.php" onsubmit="return fboardlist_submit(this);" method="post" class="eyoom-form">
    <input type="hidden" name="bo_table" value="{_bo_table}">
    <input type="hidden" name="sfl" value="{_sfl}">
    <input type="hidden" name="stx" value="{_stx}">
    <input type="hidden" name="spt" value="{_spt}">
    <input type="hidden" name="sca" value="{_sca}">
    <input type="hidden" name="page" value="{_page}">
    <input type="hidden" name="sw" value="">
	<!--{/}-->
	<div class="table-list-eb margin-bottom-20">
	    <div class="board-list-body">
        <ul id="lbboard">
        <!--{@ list}-->
        <!--{? .is_notice}--><li class="notice"><!--{: _wr_id == .wr_id}--><li class="active"><!--{:}--><li><!--{/}-->
            <!--{? _is_checkbox && _is_admin }-->
						<div class="lbcheck">
            <span class="lst_chk">
              <label for="chk_wr_id_{.key_}" class="sound_only">{.subject}</label>
              <label class="checkbox">
                <input type="checkbox" name="chk_wr_id[]" value="{.wr_id}" id="chk_wr_id_{.key_}"><i></i>
              </label>
            </span>
						</div>
						<!--{/}-->
            <a class="lblink<!--{? _is_admin}--> admin<!--{/}-->" href="{.href}">
							<div class="lbtitle<!--{? .wr_comment > 10}--> lbhot<!--{: .wr_comment > 30}--> lbbest<!--{/}-->">
								<!--{? .is_notice }--><i class="fa fa-smile-o"></i> <b>{.subject}</b><!--{:}--><!--{? .icon_file}--><i class="fa fa-picture-o color-red"></i><!--{/}--> {.subject}<!--{/}-->
	              <!--{?.icon_new}--><i class="fa fa-circle"></i>&nbsp;<!--{/}-->
	              <!--{?.icon_secret}--><i class="fa fa-lock"></i>&nbsp;<!--{/}-->
								<!--{? .comment_cnt}-->
								<span class="lbcomment"><i class="fa fa-comment-o"></i>{=number_format(.wr_comment)}</span><!--{/}-->
							</div>
							<!--{? !.is_notice}-->
							<div class="lbcontents">
							<?php
								$s = {.subject};
								if(strpos($s, '블라인드') !== false){
									$is_blind = 'y';
								} else {
									if({member.mb_id} && {member.mb_level} > 1) {
										$t = {.content};
										echo nl2br(strip_tags($t));
									} else {
										echo '<i class="fa fa-exclamation-triangle"></i> 내용 미리보기는 회원만 가능!';
									}
								}
							?>
              </div>
							<div class="lbdes">
								<span class="lbnick"><i class="fa fa-user"></i><!--{?.is_mine}-->{.wr_name}<b class="color-red">*</b><!--{:}-->{.wr_name}<!--{/}--></span>
		            <span class="lbhit"><i class="fa fa-eye"></i>{=number_format(.wr_hit)}
		            </span>
		            <!--{?_is_good}--><span class="lbup"><i class="fa fa-thumbs-up"></i>{=number_format(.wr_good)}</span><!--{/}-->
		            <span class="lbtime"><i class="fa fa-clock-o"></i><!--{? eyoom_board.bo_sel_date_type == '1'}-->{eb->date_time('m-d H:i',.wr_datetime)}<!--{: eyoom_board.bo_sel_date_type == '2'}-->{eb->date_format('Y.m.d',.wr_datetime)}<!--{/}-->
		            </span>
		          </div>
							<!--{/}-->
            </a>
        </li>
			        <!--{:}-->
					<li><span class="text-center">게시물이 없습니다.</span></li>
					<!--{/}-->
			</ul>
	  </div>
	</div>
    <div class="board-list-footer">
	    <div class="pull-left">
	        <ul class="list-unstyled board-btn-adm pull-left">
			        <!--{? _is_checkbox}-->
	            <li><button class="btn-e btn-e-light-grey" type="submit" name="btn_submit" value="선택삭제" onclick="document.pressed=this.value">선택삭제</button></li>
	            <li><button class="btn-e btn-e-light-grey" type="submit" name="btn_submit" value="선택복사" onclick="document.pressed=this.value">선택복사</button></li>
	            <li><button class="btn-e btn-e-light-grey" type="submit" name="btn_submit" value="선택이동" onclick="document.pressed=this.value">선택이동</button></li>
	        		<!--{/}-->
							<!--{?_admin_href}--><li><a href="{_admin_href}" class="btn-e btn-e-dark margin-right-5" type="button">관리자</a></li><!--{/}-->
					<!--{?_eyoom_href}--><li><a href="{_eyoom_href}" class="btn-e btn-e-dark margin-right-5" type="button">이윰설정</a></li><!--{/}-->
	        </ul>
	        <span class="pull-left">
	        	<!--{?_rss_href}--><a href="{_rss_href}" class="btn-e btn-e-yellow" type="button"><i class="fa fa-rss"></i></a><!--{/}-->
				<a href="javascript:;" class="btn-e btn-e-dark" type="button" data-toggle="modal" data-target=".search-modal"><i class="fa fa-search"></i></a>
	        </span>
	    </div>
	    <div class="pull-right">
	        <!--{? _list_href || _write_href}-->
	        <ul class="list-unstyled pull-right">
	            <!--{? _write_href}--><li><a href="{_write_href}" class="btn-e btn-e-red" type="button">글쓰기</a></li><!--{/}-->
	        </ul>
	        <!--{/}-->
	    </div>
	    <div class="clearfix"></div>
	</div>
	<!--{? _is_admin}--></form><!--{/}-->
</div>

<!--{* Small modal *}-->
<div class="modal fade search-modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-sm">
		<div class="modal-content">
			<div class="modal-header">
				<button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
				<h5 id="myLargeModalLabel" class="modal-title"><strong>{board.bo_subject} 검색</strong></h5>
			</div>
			<div class="modal-body">
				<!--{* 게시판 검색 시작 *}-->
				<fieldset id="bo_sch" class="eyoom-form">
					<!--legend>게시물 검색</legend-->
				    <form name="fsearch" method="get">
				    <input type="hidden" name="bo_table" value="{_bo_table}">
				    <input type="hidden" name="sca" value="{_sca}">
				    <input type="hidden" name="sop" value="and">
				    <label for="sfl" class="sound_only">검색대상</label>
				    <section class="margin-top-10">
					    <label class="select">
						    <select name="sfl" id="sfl" class="form-control">
						        <option value="wr_subject"{=get_selected(_sfl, 'wr_subject', true)}>제목</option>
						        <option value="wr_content"{=get_selected(_sfl, 'wr_content')}>내용</option>
						        <option value="wr_subject||wr_content"{=get_selected(_sfl, 'wr_subject||wr_content')}>제목+내용</option>
										<!--{? _is_admin == 'super'}-->
										<option value="mb_id,1"{=get_selected(_sfl, 'mb_id,1')}>회원아이디</option>
						        <option value="mb_id,0"{=get_selected(_sfl, 'mb_id,0')}>회원아이디(코)</option>
						        <option value="wr_name,1"{=get_selected(_sfl, 'wr_name,1')}>글쓴이</option>
						        <option value="wr_name,0"{=get_selected(_sfl, 'wr_name,0')}>글쓴이(코)</option>
										<!--{/}-->
						    </select>
						    <i></i>
					    </label>
				    </section>
				    <section>
					    <div class="input-group">
					        <label for="stx" class="sound_only">검색어<strong class="sound_only"> 필수</strong></label>
					        <label class="input">
					        	<input type="text" name="stx" value="{=stripslashes(_stx)}" required id="stx" class="form-control">
					        </label>
					        <span class="input-group-btn">
					            <button class="btn btn-default btn-e-group" type="submit" value="검색">검색</button>
					        </span>
					    </div>
				    </section>
				    </form>
				</fieldset>
				<!--{* 게시판 검색 끝 *}-->
			</div>
            <div class="modal-footer">
                <button data-dismiss="modal" class="btn-e btn-e-dark" type="button">닫기</button>
            </div>
		</div>
	</div>
</div>
<iframe name="photoframe" id="photoframe" style="display:none;"></iframe>
<!--{* End Small Modal *}-->

<!--{?_is_checkbox}-->
<noscript>
<p>자바스크립트를 사용하지 않는 경우<br>별도의 확인 절차 없이 바로 선택삭제 처리하므로 주의하시기 바랍니다.</p>
</noscript>
<!--{/}-->

<!--{* 페이지 *}-->
{=eb_paging('basic')}

<!--{?_is_checkbox}-->
<script>
function all_checked(sw) {
    var f = document.fboardlist;
    for (var i=0; i<f.length; i++) {
        if (f.elements[i].name == "chk_wr_id[]")
            f.elements[i].checked = sw;
    }
}

function fboardlist_submit(f) {
    var chk_count = 0;
    for (var i=0; i<f.length; i++) {
        if (f.elements[i].name == "chk_wr_id[]" && f.elements[i].checked)
            chk_count++;
    }
    if (!chk_count) {
        alert(document.pressed + "할 게시물을 하나 이상 선택하세요.");
        return false;
    }
    if(document.pressed == "선택복사") {
        select_copy("copy");
        return;
    }
    if(document.pressed == "선택이동") {
        select_copy("move");
        return;
    }
    if(document.pressed == "선택삭제") {
        if (!confirm("선택한 게시물을 정말 삭제하시겠습니까?\n\n한번 삭제한 자료는 복구할 수 없습니다\n\n답변글이 있는 게시글을 선택하신 경우\n답변글도 선택하셔야 게시글이 삭제됩니다."))
            return false;
        f.removeAttribute("target");
        f.action = "./board_list_update.php";
    }
    return true;
}

// 선택한 게시물 복사 및 이동
function select_copy(sw) {
    var f = document.fboardlist;
    if (sw == "copy")
        str = "복사";
    else
        str = "이동";

    var sub_win = window.open("", "move", "left=50, top=50, width=500, height=550, scrollbars=1");
    f.sw.value = sw;
    f.target = "move";
    f.action = "./move.php";
    f.submit();
}
</script>
<!--{/}-->
</div>
